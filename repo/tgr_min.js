(()=>{"use strict";var t,s;function e(t){return{isApplied:!0,state:t}}function r(t){return{isApplied:!1,state:t}}function i(t,s){return t>s?t:s}function n(t,s){return 0===t?s:0===s?t:t>s?s:t}function o(t,s){return Math.round((t+s)/2)}function h(t,s){return t.order>s.order?1:t.order<s.order?-1:0}function u(t,s){return t.order>s.order?-1:t.order<s.order?1:0}function a(t){return"next"in t?s=>t.next(s):t}!function(t){t.INIT="INIT",t.STARTED="STARTED",t.STOPPED="STOPPED",t.PROCESS="PROCESS",t.DESTROYED="DESTROYED",t.UNDEFINED="UNDEFINED",t.DELETED="DELETED",t.READY="READY"}(t||(t={})),function(t){t.NEGATIVE_DELAY="Delay must be a positive number.",t.TYPE_INVALID="TYPE_INVALID",t.NAME_IS_NOT_PRESENT="NAME_IS_NOT_PRESENT",t.INSTANCE_DESTROYED="INSTANCE_DESTROYED"}(s||(s={}));class c{constructor(t){this.pipe=t,this.counter=t.chain.length?t.chain.length:0}case(t){this.counter++;const s=this.counter,e=this.pipe.chain;return e.push((r=>{r.isAvailable=!0,t(r.payload)&&(r.isBreak=!0),s!==e.length||r.isBreak||(r.isAvailable=!1)})),this}pushCases(t){if(!Array.isArray(t))return this;for(let s=0;s<t.length;s++)this.case(t[s]);return this}}class l{constructor(){this.chain=[],this.flow={isBreak:!1,isUnsubscribe:!1,isAvailable:!1,payload:null}}refine(t){return this.push((s=>t(s.payload)&&(s.isAvailable=!0)))}setOnce(){return this.push((t=>{this.listener(t.payload),t.isUnsubscribe=!0}))}unsubscribeBy(t){return this.push((s=>{s.isAvailable=!0,t(s.payload)&&(s.isUnsubscribe=!0)}))}processChain(t){const s=this.chain,e=this.flow;for(let t=0;t<s.length;t++){if(e.isUnsubscribe=!1,e.isAvailable=!1,s[t](e),e.isUnsubscribe)return this.unsubscribe();if(!e.isAvailable)return;if(e.isBreak)break}return t(e.payload)}pushRefiners(t){if(!Array.isArray(t))return this;for(let s=0;s<t.length;s++)this.refine(t[s]);return this}switch(){return new d(this)}then(t){return this.push((s=>{s.payload=t(s.payload),s.isAvailable=!0}))}serialize(){return this.push((t=>{t.payload=JSON.stringify(t.payload),t.isAvailable=!0}))}deserialize(){return this.push((t=>{t.payload=JSON.parse(t.payload),t.isAvailable=!0}))}push(t){return this.chain.push(t),this}}class d extends c{subscribe(t,s){return this.pipe.subscribe(t,s)}}class E extends l{constructor(t,s){super(),this.paused=!1,this._order=0,this.piped=!1,this.errorHandler=(t,s)=>{console.log(`(Unit of SubscribeObject).send(${t}) ERROR:`,s)},this.observer=t,this.piped=!!s}get order(){return this._order}subscribe(t,s){return this.listener=function(t){if(Array.isArray(t)){const s=[];for(let e=0;e<t.length;e++)s.push(a(t[e]));return t=>{for(let e=0;e<s.length;e++)s[e](t)}}return a(t)}(t),s&&(this.errorHandler=s),this}send(t){try{this.flow.payload=t,this.flow.isBreak=!1,this.processValue(t)}catch(s){this.errorHandler(t,s)}}unsubscribe(){this.observer&&(this.observer.unSubscribe(this),this.observer=null,this.listener=null,this.chain.length=0)}resume(){this.paused=!1}pause(){this.paused=!0}set order(t){this._order=t}processValue(t){const s=this.listener;return s?this.observer&&!this.paused?this.piped?this.processChain(s):s(t):void 0:this.unsubscribe()}}class D{constructor(){this.chain=[],this.flow={isBreak:!1,isAvailable:!1,payload:null},this.response={isOK:!1,payload:void 0}}get isEmpty(){return!this.chain.length}filter(t){return this.push((s=>t(s.payload)&&(s.isAvailable=!0)))}pushFilters(t){if(!Array.isArray(t))return this;for(let s=0;s<t.length;s++)this.filter(t[s]);return this}push(t){return this.chain.push(t),this}switch(){return new p(this)}processChain(t){const s=this.chain,e=this.flow,r=this.response;r.isOK=!1,r.payload=void 0,e.payload=t,e.isBreak=!1;try{for(let t=0;t<s.length;t++){if(e.isAvailable=!1,s[t](e),!e.isAvailable)return r;if(e.isBreak)break}}catch(t){return this.errHandler?this.errHandler(t,"Filter.processChain ERROR:"):console.log("Filter.processChain ERROR:",t),r}return r.isOK=!0,r.payload=e.payload,r}addErrorHandler(t){this.errHandler=t}}class p extends c{}class T{constructor(t){this.value=t,this.subs=[],this.killed=!1,this.process=!1,this.stop=!0,this.trash=[],this.filters=new D}get isEnable(){return this.stop}get isDestroyed(){return this.killed}addFilter(t){return t&&this.filters.addErrorHandler(t),this.filters}disable(){this.stop=!1}enable(){this.stop=!0}next(t){if(!this.killed&&this.stop&&(this.filters.isEmpty||this.filters.processChain(t).isOK)){this.process=!0,this.value=t;for(let s=0;s<this.subs.length;s++)this.subs[s].send(t);this.process=!1,this.trash.length&&this.clearTrash()}}stream(t){if(!this.killed&&this.stop)for(let s=0;s<t.length;s++)this.next(t[s])}unSubscribe(t){this.killed||(this.process&&t?this.trash.push(t):this.subs&&function(t,s){const e=t.indexOf(s);-1!==e&&(t[e]=t[t.length-1],t.length=t.length-1)}(this.subs,t))}destroy(){this.value=null,this.unsubscribeAll(),this.subs=null,this.killed=!0}unsubscribeAll(){this.killed||(this.subs.length=0)}getValue(){if(!this.killed)return this.value}size(){return this.killed?0:this.subs.length}subscribe(t,s){if(!this.isListener(t))return;const e=new E(this,!1);return this.addObserver(e,t,s),e}pipe(){if(this.killed)return;const t=new E(this,!0);return this.subs.push(t),t}addObserver(t,s,e){t.subscribe(s,e),this.subs.push(t)}isListener(t){return!this.killed&&!!t}clearTrash(){const t=this.trash.length;for(let s=0;s<t;s++)this.unSubscribe(this.trash[s]);this.trash.length=0}}class f extends E{constructor(t,s){super(t,s)}get order(){return this._order}set order(t){!this.observer||this.observer&&this.observer.isDestroyed?this._order=void 0:(this._order=t,this.observer.sortByOrder())}subscribe(t,s){return super.subscribe(t,s),this}setOnce(){return super.setOnce()}}class O extends T{constructor(){super(...arguments),this.sortDirection=h}setAscendingSort(){return this.sortDirection=h,this.sortByOrder()}setDescendingSort(){return this.sortDirection=u,this.sortByOrder()}sortByOrder(){return!this.killed&&(this.subs.sort(this.sortDirection),!0)}subscribe(t,s){if(!this.isListener(t))return;const e=new f(this,!1);return this.addObserver(e,t,s),e}pipe(){if(this.killed)return;const t=new f(this,!0);return this.subs.push(t),t}unSubscribe(t){this.killed||(this.process&&t?this.trash.push(t):this.subs&&function(t,s){const e=t.indexOf(s);-1!==e&&t.splice(e,1)}(this.subs,t))}}class S{constructor(){this.state$=new T(t.UNDEFINED)}get state(){return this.state$.isDestroyed?t.DESTROYED:this.state$.getValue()??t.UNDEFINED}start(){if(this.isDestroyed())return r(t.DESTROYED);const s=this.startProcess();return s.isApplied?e(s.state):s}stop(){if(this.isDestroyed())return r(t.DESTROYED);const s=this.stopProcess();return s.isApplied?e(s.state):s}destroy(){return this.stop(),this.state$.next(t.DESTROYED),this.state$.destroy(),e(t.DESTROYED)}subscribeOnState(t){if(!this.isDestroyed())return this.state$.subscribe(t)}subscribeOnProcess(s){if(!this.isDestroyed())return this.state$.pipe()?.refine((s=>s===t.PROCESS)).subscribe(s)}isDestroyed(){return this.state===t.DESTROYED}}class P extends S{constructor(){super(...arguments),this.state$=new O(t.UNDEFINED)}subscribeOnState(t){if(!this.isDestroyed())return this.state$.subscribe(t)}subscribeOnProcess(s){if(!this.isDestroyed())return this.state$.pipe()?.refine((s=>s===t.PROCESS)).subscribe(s)}}class b extends S{constructor(){super(),this.id=0,this.delay=0}setInterval(i){return this.isDestroyed()?r(t.DESTROYED):this.id?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.id=setInterval((()=>{this.state$.next(t.PROCESS)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearInterval(this.id),this.id=0,this.state$.next(t.STOPPED),e(t.STOPPED)}}const A=t=>{const s=t._counter;t.countOfUsesPerMinute=s.minutes,t.countOfUsesPerMinuteMax=i(t.countOfUsesPerMinuteMax,s.minutes),t.countOfUsesPerMinuteMin=n(t.countOfUsesPerMinuteMin,s.minutes),t.countOfUsesPerMinuteAvg=o(t.countOfUsesPerMinuteAvg,s.minutes)},y=t=>{const s=t._counter;t.countOfUsesPerHour=s.hours,t.countOfUsesPerHourMax=i(t.countOfUsesPerHourMax,s.hours),t.countOfUsesPerHourMin=n(t.countOfUsesPerHourMin,s.hours),t.countOfUsesPerHourAvg=o(t.countOfUsesPerHourAvg,s.hours)},R=t=>{const s=t._counter;t.countOfUsesPerDay=s.days,t.countOfUsesPerDayMax=i(t.countOfUsesPerDayMax,s.days),t.countOfUsesPerDayMin=n(t.countOfUsesPerDayMin,s.days),t.countOfUsesPerDayAvg=o(t.countOfUsesPerDayAvg,s.days)};class m{constructor(){this.metrics={},this._state=t.STOPPED,this.perSecond=new b,this.perSecond.setInterval(1e3),this.perMinute=new b,this.perMinute.setInterval(6e4),this.perHour=new b,this.perHour.setInterval(36e5),this.perDay=new b,this.perDay.setInterval(864e5)}start(){return this.isDestroyed()?r(s.INSTANCE_DESTROYED):this._state===t.STARTED?r(t.STARTED):(this.perSecond.start(),this.perMinute.start(),this.perHour.start(),this.perDay.start(),this._state=t.STARTED,e(t.STARTED))}stop(){if(this.isDestroyed())return r(s.INSTANCE_DESTROYED);this.perSecond.stop(),this.perMinute.stop(),this.perHour.stop(),this.perDay.stop();for(const t in this.metrics){const s=this.metrics[t];s._counter.days=0,s._counter.hours=0,s._counter.minutes=0,s._counter.seconds=0}return this._state=t.STOPPED,e(t.STOPPED)}destroy(){return this.isDestroyed()?r(s.INSTANCE_DESTROYED):(this.stop(),this.clearFunc(),this.perSecond.destroy(),this.perMinute.destroy(),this.perHour.destroy(),this.perDay.destroy(),this._state=t.DESTROYED,e(t.DESTROYED))}isDestroyed(){return this._state===t.DESTROYED}deleteFunc(i){if(this.isDestroyed())return r(s.INSTANCE_DESTROYED);if(i in this.metrics){const s=this.metrics[i];return s._deleteObj.isDeleted=!0,s._deleteObj=null,delete this.metrics[i],e(t.DELETED)}return r(s.NAME_IS_NOT_PRESENT)}clearFunc(){const t=[];for(const s in this.metrics)t.push(s);for(const s of t)this.deleteFunc(s)}decorate(s,e){const{deleteObj:r,metric:i}=this.createMetric(s);return(...s)=>{if(r.isDeleted)return e(...s);const n=Date.now();this.trackMetric(i);try{return e(...s)}catch(s){throw r.isDeleted||this._state!==t.STARTED||i.countOfErrors++,s}finally{r.isDeleted||this._state!==t.STARTED||(i.timePerCall=Date.now()-n,i.totalExecutionTime+=i.timePerCall)}}}decorateAsync(s,e){const{deleteObj:r,metric:i}=this.createMetric(s);return async(...s)=>{if(r.isDeleted)return await e(...s);const n=Date.now();this.trackMetric(i);try{return await e(...s)}catch(s){throw r.isDeleted||this._state!==t.STARTED||i.countOfErrors++,s}finally{r.isDeleted||this._state!==t.STARTED||(i.timePerCall=Date.now()-n,i.totalExecutionTime+=i.timePerCall)}}}trackMetric(s){this._state===t.STARTED&&(s.countOfUses++,s._counter.seconds++,s._counter.minutes++,s._counter.hours++,s._counter.days++)}createMetric(t){if(t in this.metrics)throw new Error(`A function with the name "${t}" is already decorated`);if(this.isDestroyed())throw new Error(s.INSTANCE_DESTROYED);const e={isDeleted:!1};this.metrics[t]={countOfUses:0,countOfErrors:0,totalExecutionTime:0,timePerCall:0,countOfUsesPerSecond:0,countOfUsesPerMinute:0,countOfUsesPerHour:0,countOfUsesPerDay:0,countOfUsesPerDayAvg:0,countOfUsesPerDayMax:0,countOfUsesPerDayMin:0,countOfUsesPerHourAvg:0,countOfUsesPerHourMax:0,countOfUsesPerHourMin:0,countOfUsesPerMinuteAvg:0,countOfUsesPerMinuteMax:0,countOfUsesPerMinuteMin:0,countOfUsesPerSecondAvg:0,countOfUsesPerSecondMax:0,countOfUsesPerSecondMin:0,_deleteObj:e,_counter:{seconds:0,minutes:0,hours:0,days:0}};const r=this.metrics[t];return this.addTimers(e,r),{deleteObj:e,metric:r}}addTimers(t,s){const e=s._counter;this.addTimer(t,this.perSecond,(()=>{(t=>{const s=t._counter;t.countOfUsesPerSecond=s.seconds,t.countOfUsesPerSecondMax=i(t.countOfUsesPerSecondMax,s.seconds),t.countOfUsesPerSecondMin=n(t.countOfUsesPerSecondMin,s.seconds),t.countOfUsesPerSecondAvg=o(t.countOfUsesPerSecondAvg,s.seconds)})(s),A(s),y(s),R(s),e.seconds=0})),this.addTimer(t,this.perMinute,(()=>{A(s),y(s),R(s),e.minutes=0})),this.addTimer(t,this.perHour,(()=>{y(s),R(s),e.hours=0})),this.addTimer(t,this.perDay,(()=>{R(s),e.days=0}))}addTimer(t,s,e){const r=s.subscribeOnProcess((()=>{t.isDeleted?r?.unsubscribe():e()}))}getMetrics(t){const s={...this.metrics[t]};return delete s._deleteObj,delete s._counter,s}getAll(){const t={};for(const s in this.metrics)t[s]=this.getMetrics(s);return t}get length(){return Object.keys(this.metrics).length}get state(){return this._state}}new m;const _=window;_.GTimeout=class extends S{constructor(){super(),this.delay=0,this.id=0}setTimeout(i){return this.isDestroyed()?r(t.DESTROYED):this.id?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.id=setTimeout((()=>{this.state$.next(t.PROCESS),this.state$.next(t.STOPPED)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearTimeout(this.id),this.id=0,this.state$.next(t.STOPPED),e(t.STOPPED)}},_.GTimeoutOrdered=class extends P{constructor(){super(),this.delay=0,this.id=0}setTimeout(i){return this.isDestroyed()?r(t.DESTROYED):this.id?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.id=setTimeout((()=>{this.state$.next(t.PROCESS),this.state$.next(t.STOPPED)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearTimeout(this.id),this.id=0,this.state$.next(t.STOPPED),e(t.STOPPED)}},_.GInterval=b,_.GIntervalOrdered=class extends P{constructor(){super(),this.id=0,this.delay=0}setInterval(i){return this.isDestroyed()?r(t.DESTROYED):this.id?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.id=setInterval((()=>{this.state$.next(t.PROCESS)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearInterval(this.id),this.id=0,this.state$.next(t.STOPPED),e(t.STOPPED)}},_.GAnimationFrame=class extends S{constructor(){super(),this.fps=60,this.id=null}setFPS(i){return this.isDestroyed()?r(t.DESTROYED):this.id?r(t.STARTED):i<1?r(s.NEGATIVE_DELAY):(this.fps=i,e(this.state))}set60fps(){return this.setFPS(60)}set30fps(){return this.setFPS(30)}setDefault(){return this.setFPS(60)}startProcess(){if(this.id)return r(t.STARTED);let s=Math.floor(performance.now());const i=Math.floor(1e3/this.fps),n=e=>{e=Math.floor(e),this.id=requestAnimationFrame(n);const r=e-s;r>=i&&(s=e-r%i,this.state$.next(t.PROCESS))};return this.id=requestAnimationFrame(n),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return this.id?(cancelAnimationFrame(this.id),this.id=null,this.state$.next(t.STOPPED),e(t.STOPPED)):r(s.NEGATIVE_DELAY)}},_.GAnimationFrameOrdered=class extends P{constructor(){super(),this.id=null,this.fps=60,this.id=null}setFPS(i){return this.isDestroyed()?r(t.DESTROYED):this.id?r(t.STARTED):i<1?r(s.NEGATIVE_DELAY):(this.fps=i,e(this.state))}set60fps(){return this.setFPS(60)}set30fps(){return this.setFPS(30)}setDefault(){return this.setFPS(60)}startProcess(){if(this.id)return r(t.STARTED);let s=Math.floor(performance.now());const i=Math.floor(1e3/this.fps),n=e=>{e=Math.floor(e),this.id=requestAnimationFrame(n);const r=e-s;r>=i&&(s=e-r%i,this.state$.next(t.PROCESS))};return this.id=requestAnimationFrame(n),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return this.id?(cancelAnimationFrame(this.id),this.id=null,this.state$.next(t.STOPPED),e(t.STOPPED)):r(s.NEGATIVE_DELAY)}},_.GMeter=m})();