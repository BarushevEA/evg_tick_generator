(()=>{"use strict";var t,s;!function(t){t.INIT="INIT",t.STARTED="STARTED",t.STOPPED="STOPPED",t.PROCESS="PROCESS",t.DESTROYED="DESTROYED",t.UNDEFINED="UNDEFINED",t.DELETED="DELETED",t.READY="READY"}(t||(t={})),function(t){t.NEGATIVE_DELAY="Delay must be a positive number.",t.TYPE_INVALID="TYPE_INVALID",t.NAME_IS_NOT_PRESENT="NAME_IS_NOT_PRESENT",t.INSTANCE_DESTROYED="INSTANCE_DESTROYED"}(s||(s={}));const e=t=>({isApplied:!0,state:t}),r=t=>({isApplied:!1,state:t}),i=(t,s)=>t>s?t:s,n=(t,s)=>0===t?s:0===s?t:t>s?s:t,h=(t,s)=>Math.round((t+s)/2),o=(t,s)=>t.order>s.order?1:t.order<s.order?-1:0,a=(t,s)=>t.order>s.order?-1:t.order<s.order?1:0,u=t=>"next"in t?s=>t.next(s):t;class c{constructor(t){this.pipe=t,this.counter=t.chain.length?t.chain.length:0}case(t){this.counter++;const s=this.counter,e=this.pipe.chain;return e.push((r=>{r.isAvailable=!0,t(r.payload)&&(r.isBreak=!0),s!==e.length||r.isBreak||(r.isAvailable=!1)})),this}pushCases(t){if(!Array.isArray(t))return this;for(let s=0;s<t.length;s++)this.case(t[s]);return this}}class l{constructor(){this.chain=[],this.flow={isBreak:!1,isUnsubscribe:!1,isAvailable:!1,payload:null}}processChain(t){const s=this.chain,e=this.flow;for(let t=0;t<s.length;t++){if(e.isUnsubscribe=!1,e.isAvailable=!1,s[t](e),e.isUnsubscribe)return this.unsubscribe();if(!e.isAvailable)return;if(e.isBreak)break}return t(e.payload)}setOnce(){return this.push((t=>{this.listener(t.payload),t.isUnsubscribe=!0}))}unsubscribeBy(t){return this.push((s=>{s.isAvailable=!0,t(s.payload)&&(s.isUnsubscribe=!0)}))}refine(t){return this.push((s=>{t(s.payload)&&(s.isAvailable=!0)}))}pushRefiners(t){if(!Array.isArray(t))return this;for(let s=0;s<t.length;s++)this.refine(t[s]);return this}switch(){return new d(this)}then(t){return this.push((s=>{s.payload=t(s.payload),s.isAvailable=!0}))}serialize(){return this.push((t=>{t.payload=JSON.stringify(t.payload),t.isAvailable=!0}))}deserialize(){return this.push((t=>{t.payload=JSON.parse(t.payload),t.isAvailable=!0}))}push(t){return this.chain.push(t),this}}class d extends c{subscribe(t,s){return this.pipe.subscribe(t,s)}}class E extends l{get order(){return this._order}constructor(t,s){super(),this._order=0,this.isPaused=!1,this.isPipe=!1,this.errorHandler=(t,s)=>{console.log(`(Unit of SubscribeObject).send(${t}) ERROR:`,s)},this.observable=t,this.isPipe=!!s}subscribe(t,s){return this.listener=(t=>{if(Array.isArray(t)){const s=[];for(let e=0;e<t.length;e++)s.push(u(t[e]));return t=>{for(let e=0;e<s.length;e++)s[e](t)}}return u(t)})(t),s&&(this.errorHandler=s),this}unsubscribe(){this.observable&&(this.observable.unSubscribe(this),this.observable=null,this.listener=null,this.chain.length=0)}send(t){try{this.flow.payload=t,this.flow.isBreak=!1,this.processValue(t)}catch(s){this.errorHandler(t,s)}}resume(){this.isPaused=!1}pause(){this.isPaused=!0}set order(t){this._order=t}processValue(t){const s=this.listener;return s?this.observable&&!this.isPaused?this.isPipe?this.processChain(s):s(t):void 0:this.unsubscribe()}}class D{constructor(){this.chain=[],this.flow={isBreak:!1,isAvailable:!1,payload:null},this.response={isOK:!1,payload:void 0}}get isEmpty(){return!this.chain.length}pushFilters(t){if(!Array.isArray(t))return this;for(let s=0;s<t.length;s++)this.filter(t[s]);return this}filter(t){return this.push((s=>{t(s.payload)&&(s.isAvailable=!0)}))}push(t){return this.chain.push(t),this}switch(){return new T(this)}processChain(t){const s=this.chain,e=this.flow,r=this.response;r.isOK=!1,r.payload=void 0,e.payload=t,e.isBreak=!1;try{for(let t=0;t<s.length;t++){if(e.isAvailable=!1,s[t](e),!e.isAvailable)return r;if(e.isBreak)break}}catch(t){return this.errHandler?this.errHandler(t,"Filter.processChain ERROR:"):console.log("Filter.processChain ERROR:",t),r}return r.isOK=!0,r.payload=e.payload,r}addErrorHandler(t){this.errHandler=t}}class T extends c{}class S{constructor(t){this.value=t,this.listeners=[],this.isStop=!0,this.isKilled=!1,this.isProcess=!1,this.trash=[],this.filters=new D}addFilter(t){return t&&this.filters.addErrorHandler(t),this.filters}disable(){this.isStop=!1}enable(){this.isStop=!0}get isEnable(){return this.isStop}next(t){if(!this.isKilled&&this.isStop&&(this.filters.isEmpty||this.filters.processChain(t).isOK)){this.isProcess=!0,this.value=t;for(let s=0;s<this.listeners.length;s++)this.listeners[s].send(t);this.isProcess=!1,this.trash.length&&this.handleListenersForUnsubscribe()}}stream(t){if(!this.isKilled&&this.isStop)for(let s=0;s<t.length;s++)this.next(t[s])}get isDestroyed(){return this.isKilled}unSubscribe(t){this.isKilled||(this.isProcess&&t?this.trash.push(t):this.listeners&&((t,s)=>{const e=t.indexOf(s);-1!==e&&(t[e]=t[t.length-1],t.length=t.length-1)})(this.listeners,t))}destroy(){this.value=null,this.unsubscribeAll(),this.listeners=null,this.isKilled=!0}unsubscribeAll(){this.isKilled||(this.listeners.length=0)}getValue(){if(!this.isKilled)return this.value}size(){return this.isKilled?0:this.listeners.length}subscribe(t,s){if(!this.isListener(t))return;const e=new E(this,!1);return this.addObserver(e,t,s),e}addObserver(t,s,e){t.subscribe(s,e),this.listeners.push(t)}isListener(t){return!this.isKilled&&!!t}pipe(){if(this.isKilled)return;const t=new E(this,!0);return this.listeners.push(t),t}handleListenersForUnsubscribe(){const t=this.trash.length;for(let s=0;s<t;s++)this.unSubscribe(this.trash[s]);this.trash.length=0}}class f extends E{constructor(t,s){super(t,s)}get order(){return this._order}set order(t){!this.observable||this.observable&&this.observable.isDestroyed?this._order=void 0:(this._order=t,this.observable.sortByOrder())}subscribe(t,s){return super.subscribe(t,s),this}setOnce(){return super.setOnce()}}class p extends S{constructor(){super(...arguments),this.sortDirection=o}setAscendingSort(){return this.sortDirection=o,this.sortByOrder()}setDescendingSort(){return this.sortDirection=a,this.sortByOrder()}sortByOrder(){return!this.isKilled&&(this.listeners.sort(this.sortDirection),!0)}subscribe(t,s){if(!this.isListener(t))return;const e=new f(this,!1);return this.addObserver(e,t,s),e}pipe(){if(this.isKilled)return;const t=new f(this,!0);return this.listeners.push(t),t}unSubscribe(t){this.isKilled||(this.isProcess&&t?this.trash.push(t):this.listeners&&((t,s)=>{const e=t.indexOf(s);-1!==e&&t.splice(e,1)})(this.listeners,t))}}class O{constructor(){this.state$=new S(t.UNDEFINED)}get state(){return this.state$.isDestroyed?t.DESTROYED:this.state$.getValue()??t.UNDEFINED}start(){if(this.isDestroyed())return r(t.DESTROYED);const s=this.startProcess();return s.isApplied?e(s.state):s}stop(){if(this.isDestroyed())return r(t.DESTROYED);const s=this.stopProcess();return s.isApplied?e(s.state):s}destroy(){return this.stop(),this.state$.next(t.DESTROYED),this.state$.destroy(),e(t.DESTROYED)}subscribeOnState(t){if(!this.isDestroyed())return this.state$.subscribe(t)}subscribeOnProcess(s){if(!this.isDestroyed())return this.state$.pipe()?.refine((s=>s===t.PROCESS)).subscribe(s)}isDestroyed(){return this.state===t.DESTROYED}}class P extends O{constructor(){super(...arguments),this.state$=new p(t.UNDEFINED)}subscribeOnState(t){if(!this.isDestroyed())return this.state$.subscribe(t)}subscribeOnProcess(s){if(!this.isDestroyed())return this.state$.pipe()?.refine((s=>s===t.PROCESS)).subscribe(s)}}class b extends O{constructor(){super(),this.intervalId=0,this.delay=0}setInterval(i){return this.isDestroyed()?r(t.DESTROYED):this.intervalId?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.intervalId=setInterval((()=>{this.state$.next(t.PROCESS)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearInterval(this.intervalId),this.intervalId=0,this.state$.next(t.STOPPED),e(t.STOPPED)}}const A=t=>{const s=t._counter;t.countOfUsesPerMinute=s.minutes,t.countOfUsesPerMinuteMax=i(t.countOfUsesPerMinuteMax,s.minutes),t.countOfUsesPerMinuteMin=n(t.countOfUsesPerMinuteMin,s.minutes),t.countOfUsesPerMinuteAvg=h(t.countOfUsesPerMinuteAvg,s.minutes)},y=t=>{const s=t._counter;t.countOfUsesPerHour=s.hours,t.countOfUsesPerHourMax=i(t.countOfUsesPerHourMax,s.hours),t.countOfUsesPerHourMin=n(t.countOfUsesPerHourMin,s.hours),t.countOfUsesPerHourAvg=h(t.countOfUsesPerHourAvg,s.hours)},m=t=>{const s=t._counter;t.countOfUsesPerDay=s.days,t.countOfUsesPerDayMax=i(t.countOfUsesPerDayMax,s.days),t.countOfUsesPerDayMin=n(t.countOfUsesPerDayMin,s.days),t.countOfUsesPerDayAvg=h(t.countOfUsesPerDayAvg,s.days)};class I{constructor(){this.metrics={},this._state=t.STOPPED,this.perSecondTimer=new b,this.perSecondTimer.setInterval(1e3),this.perMinuteTimer=new b,this.perMinuteTimer.setInterval(6e4),this.perHourTimer=new b,this.perHourTimer.setInterval(36e5),this.perDayTimer=new b,this.perDayTimer.setInterval(864e5)}start(){return this.isDestroyed()?r(s.INSTANCE_DESTROYED):this._state===t.STARTED?r(t.STARTED):(this.perSecondTimer.start(),this.perMinuteTimer.start(),this.perHourTimer.start(),this.perDayTimer.start(),this._state=t.STARTED,e(t.STARTED))}stop(){if(this.isDestroyed())return r(s.INSTANCE_DESTROYED);this.perSecondTimer.stop(),this.perMinuteTimer.stop(),this.perHourTimer.stop(),this.perDayTimer.stop();for(const t in this.metrics){const s=this.metrics[t];s._counter.days=0,s._counter.hours=0,s._counter.minutes=0,s._counter.seconds=0}return this._state=t.STOPPED,e(t.STOPPED)}destroy(){return this.isDestroyed()?r(s.INSTANCE_DESTROYED):(this.stop(),this.clearFunc(),this.perSecondTimer.destroy(),this.perMinuteTimer.destroy(),this.perHourTimer.destroy(),this.perDayTimer.destroy(),this._state=t.DESTROYED,e(t.DESTROYED))}isDestroyed(){return this._state===t.DESTROYED}deleteFunc(i){if(this.isDestroyed())return r(s.INSTANCE_DESTROYED);if(i in this.metrics){const s=this.metrics[i];return s._deleteObj.isDeleted=!0,s._deleteObj=null,delete this.metrics[i],e(t.DELETED)}return r(s.NAME_IS_NOT_PRESENT)}clearFunc(){const t=[];for(const s in this.metrics)t.push(s);for(const s of t)this.deleteFunc(s)}decorate(s,e){const{deleteObj:r,metric:i}=this.createMetric(s);return(...s)=>{if(r.isDeleted)return e(...s);const n=Date.now();this.trackMetric(i);try{return e(...s)}catch(s){throw r.isDeleted||this._state!==t.STARTED||i.countOfErrors++,s}finally{r.isDeleted||this._state!==t.STARTED||(i.timePerCall=Date.now()-n,i.totalExecutionTime+=i.timePerCall)}}}decorateAsync(s,e){const{deleteObj:r,metric:i}=this.createMetric(s);return async(...s)=>{if(r.isDeleted)return await e(...s);const n=Date.now();this.trackMetric(i);try{return await e(...s)}catch(s){throw r.isDeleted||this._state!==t.STARTED||i.countOfErrors++,s}finally{r.isDeleted||this._state!==t.STARTED||(i.timePerCall=Date.now()-n,i.totalExecutionTime+=i.timePerCall)}}}trackMetric(s){this._state===t.STARTED&&(s.countOfUses++,s._counter.seconds++,s._counter.minutes++,s._counter.hours++,s._counter.days++)}createMetric(t){if(t in this.metrics)throw new Error(`A function with the name "${t}" is already decorated`);if(this.isDestroyed())throw new Error(s.INSTANCE_DESTROYED);const e={isDeleted:!1};this.metrics[t]={countOfUses:0,countOfErrors:0,totalExecutionTime:0,timePerCall:0,countOfUsesPerSecond:0,countOfUsesPerMinute:0,countOfUsesPerHour:0,countOfUsesPerDay:0,countOfUsesPerDayAvg:0,countOfUsesPerDayMax:0,countOfUsesPerDayMin:0,countOfUsesPerHourAvg:0,countOfUsesPerHourMax:0,countOfUsesPerHourMin:0,countOfUsesPerMinuteAvg:0,countOfUsesPerMinuteMax:0,countOfUsesPerMinuteMin:0,countOfUsesPerSecondAvg:0,countOfUsesPerSecondMax:0,countOfUsesPerSecondMin:0,_deleteObj:e,_counter:{seconds:0,minutes:0,hours:0,days:0}};const r=this.metrics[t];return this.addTimers(e,r),{deleteObj:e,metric:r}}addTimers(t,s){const e=s._counter;this.addTimer(t,this.perSecondTimer,(()=>{(t=>{const s=t._counter;t.countOfUsesPerSecond=s.seconds,t.countOfUsesPerSecondMax=i(t.countOfUsesPerSecondMax,s.seconds),t.countOfUsesPerSecondMin=n(t.countOfUsesPerSecondMin,s.seconds),t.countOfUsesPerSecondAvg=h(t.countOfUsesPerSecondAvg,s.seconds)})(s),A(s),y(s),m(s),e.seconds=0})),this.addTimer(t,this.perMinuteTimer,(()=>{A(s),y(s),m(s),e.minutes=0})),this.addTimer(t,this.perHourTimer,(()=>{y(s),m(s),e.hours=0})),this.addTimer(t,this.perDayTimer,(()=>{m(s),e.days=0}))}addTimer(t,s,e){const r=s.subscribeOnProcess((()=>{t.isDeleted?r?.unsubscribe():e()}))}getMetrics(t){const s={...this.metrics[t]};return delete s._deleteObj,delete s._counter,s}getAll(){const t={};for(const s in this.metrics)t[s]=this.getMetrics(s);return t}get length(){return Object.keys(this.metrics).length}get state(){return this._state}}new I;const R=window;R.GTimeout=class extends O{constructor(){super(),this.delay=0,this.timerId=0}setTimeout(i){return this.isDestroyed()?r(t.DESTROYED):this.timerId?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.timerId=setTimeout((()=>{this.state$.next(t.PROCESS),this.state$.next(t.STOPPED)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearTimeout(this.timerId),this.timerId=0,this.state$.next(t.STOPPED),e(t.STOPPED)}},R.GTimeoutOrdered=class extends P{constructor(){super(),this.delay=0,this.timerId=0}setTimeout(i){return this.isDestroyed()?r(t.DESTROYED):this.timerId?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.timerId=setTimeout((()=>{this.state$.next(t.PROCESS),this.state$.next(t.STOPPED)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearTimeout(this.timerId),this.timerId=0,this.state$.next(t.STOPPED),e(t.STOPPED)}},R.GInterval=b,R.GIntervalOrdered=class extends P{constructor(){super(),this.intervalId=0,this.delay=0}setInterval(i){return this.isDestroyed()?r(t.DESTROYED):this.intervalId?r(t.STARTED):i<0?r(s.NEGATIVE_DELAY):(this.delay=i,this.state$.next(t.INIT),e(t.INIT))}startProcess(){return this.intervalId=setInterval((()=>{this.state$.next(t.PROCESS)}),this.delay),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return clearInterval(this.intervalId),this.intervalId=0,this.state$.next(t.STOPPED),e(t.STOPPED)}},R.GAnimationFrame=class extends O{constructor(){super(),this.fps=60,this.rafId=null}setFPS(i){return this.isDestroyed()?r(t.DESTROYED):this.rafId?r(t.STARTED):i<1?r(s.NEGATIVE_DELAY):(this.fps=i,e(this.state))}set60fps(){return this.setFPS(60)}set30fps(){return this.setFPS(30)}setDefault(){return this.setFPS(60)}startProcess(){if(this.rafId)return r(t.STARTED);let s=Math.floor(performance.now());const i=Math.floor(1e3/this.fps),n=e=>{e=Math.floor(e),this.rafId=requestAnimationFrame(n);const r=e-s;r>=i&&(s=e-r%i,this.state$.next(t.PROCESS))};return this.rafId=requestAnimationFrame(n),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return this.rafId?(cancelAnimationFrame(this.rafId),this.rafId=null,this.state$.next(t.STOPPED),e(t.STOPPED)):r(s.NEGATIVE_DELAY)}},R.GAnimationFrameOrdered=class extends P{constructor(){super(),this.rafId=null,this.fps=60,this.rafId=null}setFPS(i){return this.isDestroyed()?r(t.DESTROYED):this.rafId?r(t.STARTED):i<1?r(s.NEGATIVE_DELAY):(this.fps=i,e(this.state))}set60fps(){return this.setFPS(60)}set30fps(){return this.setFPS(30)}setDefault(){return this.setFPS(60)}startProcess(){if(this.rafId)return r(t.STARTED);let s=Math.floor(performance.now());const i=Math.floor(1e3/this.fps),n=e=>{e=Math.floor(e),this.rafId=requestAnimationFrame(n);const r=e-s;r>=i&&(s=e-r%i,this.state$.next(t.PROCESS))};return this.rafId=requestAnimationFrame(n),this.state$.next(t.STARTED),e(t.STARTED)}stopProcess(){return this.rafId?(cancelAnimationFrame(this.rafId),this.rafId=null,this.state$.next(t.STOPPED),e(t.STOPPED)):r(s.NEGATIVE_DELAY)}},R.TickCounter=class{constructor(s){this.subject=s,this._state=t.UNDEFINED,this.defaultPeriodMs=1e3,this.periodMs=0,this.sum=0,this.counter=0,this.counter$=new S(this.counter),this.init()}init(){this._state=t.INIT,this.resetPeriod()}get state(){return this._state}getTicksPerPeriod(){return this.counter}getTicksSum(){return this.sum}resetPeriod(){return this.isDestroyed()&&r(s.INSTANCE_DESTROYED),this.state===t.STARTED&&r(this.state),this.periodMs=this.defaultPeriodMs,e(this.state)}setPeriod(i){return this.isDestroyed()&&r(s.INSTANCE_DESTROYED),this.state===t.STARTED&&r(this.state),"number"!=typeof i||i<0?{isApplied:!1,state:s.TYPE_INVALID}:(this.periodMs=i,e(this.state))}subscribe(t){if(!this.isDestroyed())return this.counter$.subscribe(t)}start(){this.isDestroyed()&&r(s.INSTANCE_DESTROYED),this.state===t.STARTED&&r(t.STARTED);let i=0;return this.subscriber=this.subject.subscribeOnProcess((()=>{i++,this.sum++})),this.timer=setInterval((()=>{this.counter=i,i=0,this.counter$.next(this.counter),this._state=t.READY}),this.periodMs),this._state=t.STARTED,e(this.state)}stop(){return this.isDestroyed()&&r(s.INSTANCE_DESTROYED),this.timer&&clearInterval(this.timer),this.subscriber?.unsubscribe(),this.counter=0,this.sum=0,this._state=t.STOPPED,e(this.state)}isDestroyed(){return this._state===t.DESTROYED}destroy(){return this.stop(),this.counter$.destroy(),this._state=t.DESTROYED,e(this.state)}},R.GMeter=I})();